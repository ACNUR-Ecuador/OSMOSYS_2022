<div class="grid">
    <div class="col-12">
        <p-toast></p-toast>
        <div class="card px-6 py-6">
            

            <p-table #dt [value]="items" [columns]="selectedColumns" [rows]="10" 
         [paginator]="true" [rowHover]="true" dataKey="id"
         styleClass="p-datatable-striped" 
         currentPageReportTemplate=" {first} a {last} de {totalRecords} "
         [showCurrentPageReport]="true"
         (sortFunction)="utilsService.customSort($event, cols)" [customSort]="true" 
         [rowsPerPageOptions]="[10,25,50]">

    <ng-template pTemplate="header" let-columns>
        <tr>
            <th style="width: 3rem"></th> <!-- Columna para el botón de expansión -->
            <th *ngFor="let col of columns" [pSortableColumn]="col.field">
                {{col.header}}
                <p-sortIcon [field]="col.field"></p-sortIcon>
            </th>
            <th>Acciones</th>
        </tr>
    </ng-template>

    <ng-template pTemplate="body" let-rowData let-columns="columns">
        <tr>
            <td>
                <button pButton pRipple type="button"
                        [icon]="expandedRowKeys[rowData.id] ? 'pi pi-chevron-up' : 'pi pi-chevron-down'"
                        [pRowToggler]="rowData"
                        (click)="toggleRow(rowData)">
                </button>


            </td>
            <td *ngFor="let col of columns">
                {{ col.pipeRef ? col.pipeRef.transform(utilsService.resolveFieldData(rowData, col.field)) : utilsService.resolveFieldData(rowData, col.field) }}
            </td>
            <td>
                <button pButton pRipple icon="pi pi-pencil" class="p-button-rounded p-button-primary"
                        (click)="openDialog(rowData)">
                </button>
            </td>
        </tr>
        <!-- Sección de expansión -->
        <tr *ngIf="expandedRowKeys[rowData.id]">
            <td colspan="100%">
                <div class="p-3">
                    <h5>Detalles por Trimestre</h5>
                    <p-table [value]="rowData.resultManagerIndicatorQuarter" dataKey="quarter">
                        <ng-template pTemplate="header">
                            <tr>
                                <th>Trimestre</th>
                                <th>Ejecución</th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-quarterData>
                            <tr>
                                <td>Trimestre {{ quarterData.quarter }}</td>
                                <td>{{ quarterData.quarterExecution }}</td>
                            </tr>
                        </ng-template>
                    </p-table>
                </div>
            </td>
        </tr>
    </ng-template>

</p-table>


        </div>
    </div>
</div>


<form [formGroup]="formItem" (ngSubmit)="saveItem()">
    <p-dialog [(visible)]="showDialog" [style]="{width: '70%'}" header="Área" [modal]="true"
              [closable]="false">

        <ng-template pTemplate="content">
            <p-messages></p-messages>
        </ng-template>

        <ng-template pTemplate="footer">
            <button pButton type="submit"
                    [disabled]="!formItem.valid"
                    pRipple label="Guardar" icon="pi pi-check"
            ></button>
            <button pButton type="button" pRipple label="Cancelar" icon="pi pi-times" class="p-button-secondary"
                    (click)="cancelDialog()"></button>

        </ng-template>
    </p-dialog>
</form>
